# =============================================================
# Fynt — Self-Hosted Setup
# =============================================================
#
# QUICK START
# -----------
#  Docker full stack (recommended):
#    1. cp .env.docker.example .env.docker
#    2. Fill required secrets
#    3. docker compose up --build
#
#  Manual pnpm setup:
#    1. cp .env.example .env
#    2. Fill in every value marked  ← REQUIRED
#    3. Run migrations + seed
#    4. Start services with pnpm
#
# SERVICES
# --------
#  • apps/web      — Next.js frontend  (port 3000)
#  • apps/worker   — Background job processor
#  • apps/realtime — WebSocket server  (port 3101)
#
# =============================================================


# -------------------------------------------------------------
# DATABASE (PostgreSQL)
# -------------------------------------------------------------

# Full connection string.                              ← REQUIRED
# Format: postgresql://USER:PASSWORD@HOST:PORT/DBNAME
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/fynt


# -------------------------------------------------------------
# AUTHENTICATION  (better-auth)
# -------------------------------------------------------------

# Your app's public base URL.                         ← REQUIRED
# In production, set this to your actual domain, e.g. https://app.fynt.io
BETTER_AUTH_URL=http://localhost:3000
NEXT_PUBLIC_BETTER_AUTH_URL=http://localhost:3000
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Long random secret used to sign sessions & tokens.  ← REQUIRED
# Generate: openssl rand -base64 48
BETTER_AUTH_SECRET=replace_with_long_random_secret

# Local tunnel URL — only needed during development when testing webhooks
# Example: https://xxxx.ngrok-free.app
NGROK_URL=


# -------------------------------------------------------------
# RUNTIME MODE
# -------------------------------------------------------------

# Runtime mode controls whether execution APIs are available.
# web-only: editor stays usable, but execute/webhook/ws-token routes are blocked.
# full: enables execution paths (requires worker/realtime and Redis).
FYNT_RUNTIME_MODE=full
NEXT_PUBLIC_FYNT_RUNTIME_MODE=full


# -------------------------------------------------------------
# SECURITY
# -------------------------------------------------------------

# 64-char hex string (32 bytes) — encrypts all stored credentials.  ← REQUIRED
# Generate: openssl rand -hex 32
# IMPORTANT: Must be identical across web and worker.
#            Never change this after you have saved credentials.
ENCRYPTION_KEY=replace_with_64_hex_chars


# -------------------------------------------------------------
# REDIS  (job queue · rate limiting · sessions · pub/sub)
# -------------------------------------------------------------

REDIS_HOST=localhost
REDIS_PORT=6379


# -------------------------------------------------------------
# REALTIME  (WebSocket execution streaming)
# -------------------------------------------------------------

# Public WebSocket URL seen by the browser
NEXT_PUBLIC_EXECUTION_WS_URL=ws://localhost:3101

# Server-side WebSocket URL used by the web app
EXECUTION_WS_URL=ws://localhost:3101

# Realtime server bind address and port
REALTIME_HOST=0.0.0.0
REALTIME_PORT=3101

# Optional dedicated signing secret for WebSocket tokens.
# Falls back to BETTER_AUTH_SECRET when unset.
# EXECUTION_STREAM_SIGNING_SECRET=


# -------------------------------------------------------------
# OPTIONAL — Webhook rate limiting
# -------------------------------------------------------------

# WEBHOOK_IP_RATE_LIMIT_PER_MINUTE=120
# WEBHOOK_ENDPOINT_RATE_LIMIT_PER_MINUTE=60
# WEBHOOK_MAX_BODY_BYTES=262144


# -------------------------------------------------------------
# OPTIONAL — Advanced tuning  (defaults are production-ready)
# -------------------------------------------------------------

# Concurrent run reservation lock
# RUN_RESERVATION_LOCK_TTL_SECONDS=10
# RUN_RESERVATION_LOCK_WAIT_MS=1500
# RUN_RESERVATION_LOCK_RETRY_MS=40

# Cron scheduler health checks
# CRON_DB_HEALTHCHECK_TIMEOUT_MS=5000
# CRON_DB_HEALTHCHECK_RETRIES=2
# CRON_DB_HEALTHCHECK_RETRY_DELAY_MS=500
# CRON_DEDUPE_TTL_SECONDS=691200

# Maximum duration for a Delay node (ms) — default is 5 minutes
# DELAY_NODE_MAX_MS=300000

# Next.js build output directory override
# NEXT_DIST_DIR=.next-build
